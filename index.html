<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SealTech System: The Future of Preservation</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* Base font and styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        
        /* Container for the dynamic bar chart */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px; /* Fixed height for Chart.js */
        }

        /* Styling for the particle simulation container */
        #seal-bag-visual {
            /* Set initial size and allow for animation via JS */
            width: 280px;
            height: 200px;
            transition: all 2s ease-in-out; /* Smooth transition for size changes (CSS effect) */
            position: relative; /* Crucial for absolute positioning of particles */
            overflow: hidden; /* Keep particles inside the boundary */
            will-change: width, height; /* Optimization for CSS transition */
        }
        
        /* Particle styling */
        .air-particle {
            position: absolute;
            width: 5px;
            height: 5px;
            background-color: #0ea5e9; /* sky-500 */
            border-radius: 50%;
            transition: opacity 0.5s; /* Smooth fade-out when removed */
            /* No CSS transitions for position, movement handled by JS for physics */
        }
        
        /* Styling for the pump light indicator (fixes missing element for existing JS) */
        #seal-pump-light {
            background-color: #ef4444; /* red-500 (off/ready) */
            transition: all 0.5s ease;
        }
        #seal-pump-light.pump-on {
            background-color: #22c55e; /* green-500 (on/working) */
            box-shadow: 0 0 10px #22c55e;
        }

    </style>
</head>
<body class="text-slate-700">

    <header class="bg-white/80 backdrop-blur-lg fixed top-0 left-0 right-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                
                <!-- Logo and Branding (FIXED: Replaced local file URL with professional placeholder) -->
                <a href="#" class="flex items-center space-x-3 text-3xl font-extrabold text-sky-700 transition duration-150 ease-in-out hover:text-sky-900">
                    <img 
                        class="h-8 w-8 rounded-xl shadow-lg border-2 border-sky-200" 
                        src="https://placehold.co/40x40/0ea5e9/ffffff?text=ST"
                        alt="SealTech Logo"
                    >
                    <span class="text-2xl font-bold text-sky-600">SealTech</span>
                </a>

                <!-- Navigation Links -->
                <nav class="hidden md:flex space-x-8 text-gray-700 font-semibold">
                    <a href="#how-it-works" class="hover:text-sky-600 transition duration-150 py-2">The Science</a>
                    <a href="#components" class="hover:text-sky-600 transition duration-150 py-2">Components</a>
                    <a href="#usage" class="hover:text-sky-600 transition duration-150 py-2">How to Use</a>
                    <a href="#benefits" class="hover:text-sky-600 transition duration-150 py-2">Benefits</a>
                    <a href="#user-model" class="hover:text-sky-600 transition duration-150 py-2">Showcase</a>
                </nav>
            </div>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="pt-24 pb-16 md:pt-32 md:pb-24 bg-white">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h1 class="text-5xl sm:text-6xl lg:text-7xl font-extrabold tracking-tighter text-slate-800">Preserve More. <span class="text-sky-600">Store Smarter.</span></h1>
                <p class="mt-4 md:mt-6 text-lg md:text-xl text-slate-600">The SealTech System provides durable, long-term vacuum sealing for everything, from seasonal clothing to large food batches, making preservation simple and effective!</p>
                <a href="#how-it-works" class="mt-8 inline-block bg-sky-600 text-white font-semibold px-8 py-3 rounded-lg shadow-lg hover:bg-sky-700 transition-all transform hover:scale-105">Discover How It Works</a>
            </div>
        </section>

        <!-- How It Works Section (Vacuum Simulation) -->
        <section id="how-it-works" class="py-20 bg-slate-100">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-slate-800">The Science of the Vacuum</h2>
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-slate-600">The SealTech System uses the SealPump to actively remove air molecules from the specialized SealBag. This creates a powerful vacuum. The external atmospheric pressure then compresses the bag, significantly reducing its volume (Boyle's Law applied externally), locking contents in a compact, protected state.</p>
                </div>

                <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div class="bg-white p-6 rounded-xl shadow-xl border-t-4 border-sky-600">
                        <h3 class="text-xl font-semibold mb-4 text-center text-slate-800"> SealPump Demonstration</h3>
                        <div class="flex justify-center items-center h-48 mb-6 relative">
                            <!-- Visual representation of the bag -->
                            <div id="seal-bag-visual" class="bg-sky-200/50 border-4 border-dashed border-sky-600 rounded-xl">
                                <!-- Particle container: particles are absolutely positioned inside this -->
                                <div class="absolute inset-0" id="air-particles-container">
                                    <!-- Air particles will be dynamically generated and animated by JS -->
                                </div>
                                <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                    <span class="text-3xl" id="content-icon">üëï</span>
                                </div>
                            </div>
                            <span class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-white text-xs font-bold text-slate-600 px-3 py-1 rounded-full shadow-md">SealBag</span>
                        </div>
                        <div class="text-center space-x-4">
                            <button id="activate-pump-btn" class="bg-sky-600 text-white font-semibold px-8 py-3 rounded-full hover:bg-sky-700 transition-colors shadow-lg shadow-sky-300/50">
                                Start SealPump
                            </button>
                            <!-- Added Pump Status Light -->
                            <span id="seal-pump-light" class="w-3 h-3 rounded-full inline-block align-middle transition-colors duration-500 shadow-inner"></span>
                            <button id="reset-btn" class="hidden bg-slate-700 text-white font-semibold px-8 py-3 rounded-full hover:bg-slate-800 transition-colors shadow-lg shadow-slate-300/50">
                                Reset Bag
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <div class="chart-container bg-white p-4 rounded-xl shadow-xl border-t-4 border-slate-700">
                            <canvas id="boylesLawChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Core Components Section -->
        <section id="components" class="py-20">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-slate-800">Engineered for Performance</h2>
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-slate-600">Every part of the SealTech System is manufactured to be user-friendly and simple, while also extremely effective. Explore the components.</p>
                </div>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-white p-8 rounded-xl shadow-lg border-l-4 border-sky-500">
                        <h3 class="text-2xl font-bold mb-4 text-slate-800">The SealBag</h3>
                        <ul class="space-y-3">
                            <li class="flex items-start">
                                <span class="text-sky-600 font-bold mr-3 mt-1 text-lg">&#9733;</span>
                                <span><strong class="font-semibold">Heavy-Duty Material:</strong> A multi-layer polymer blend stops  tears and ensures long-term air tightness, perfect for both food and cloth.</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-sky-600 font-bold mr-3 mt-1 text-lg">&#9733;</span>
                                <span><strong class="font-semibold">Proprietary Sealing Track:</strong> An extra-wide, double-track zipper creates a high-pressure, airtight seal that locks in freshness.</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-sky-600 font-bold mr-3 mt-1 text-lg">&#9733;</span>
                                <span><strong class="font-semibold">High-Flow Valve:</strong> The reinforced one-way valve allows for rapid air extraction and reliably prevents any air leakage over storage time.</span>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- SealPump Component Card with Mode Selection -->
                    <div class="bg-white p-8 rounded-xl shadow-lg border-l-4 border-slate-500">
                        <h3 class="text-2xl font-bold mb-4 text-slate-800 text-center">The SealPump Model</h3>

                        <h3 class="text-xl font-bold mb-4 text-slate-800">Operating Modes</h3>
                        <p class="mb-4 text-slate-600">A powerful, rechargeable pump with intelligent modes for every need. </p>
                        <div class="flex space-x-2 mb-4 border-b border-slate-300">
                            <!-- Quick-Seal is default active -->
                            <button data-mode="quick" class="mode-btn flex-1 p-3 font-semibold border-b-2 border-sky-600 text-sky-600 transition-colors">Quick-Seal</button>
                            <button data-mode="deep" class="mode-btn flex-1 p-3 font-semibold border-b-2 border-transparent text-slate-500 transition-colors">Deep-Seal</button>
                        </div>
                        <div id="mode-description">
                            <!-- Default quick-seal description loaded here by JS -->
                        </div>
                    </div>
                    <!-- END SealPump Component Card with Model Design -->
                </div>
            </div>
        </section>

        <!-- New User Model Showcase Section (Image Upload) -->
        <section id="user-model" class="py-20 bg-slate-100">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-slate-800">SealTech Showcase</h2>
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-slate-600">See how much space you save!</p>
                </div>
                <div class="flex justify-center">
                    <div class="w-full max-w-xl bg-white p-6 rounded-xl shadow-xl border-t-4 border-sky-600">
                        <label for="model-image-upload" class="block text-center cursor-pointer p-8 border-2 border-dashed border-slate-300 rounded-lg hover:border-sky-500 transition-colors">
                            <div id="image-upload-placeholder">
                                <span class="text-6xl text-slate-400">üì∏</span>
                                <p class="mt-2 text-slate-500 font-medium">Click to Upload Your Sealed Item Photo</p>
                                <p id="upload-status" class="text-sm text-slate-400 mt-1">No file selected.</p>
                            </div>
                            <!-- Image display area (hidden initially) -->
                            <div id="uploaded-model-image" class="hidden relative">
                                <img src="https://placehold.co/400x300/10b981/ffffff?text=Your+Sealed+Item" alt="Uploaded Sealed Item" class="w-full h-auto rounded-lg shadow-lg">
                                <div class="absolute inset-0 flex items-center justify-center bg-black/30 rounded-lg opacity-0 hover:opacity-100 transition-opacity">
                                    <span class="text-white text-xl font-bold">Image Uploaded!</span>
                                </div>
                            </div>
                        </label>
                        <input type="file" id="model-image-upload" accept="image/*" class="hidden">
                        <p class="mt-4 text-center text-sm text-slate-500">Note: This is a simulated upload for demonstration purposes.</p>
                    </div>
                </div>
            </div>
        </section>


        <!-- How to Use Section -->
        <section id="usage" class="py-20">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-slate-800">Simple 5-Step Process</h2>
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-slate-600">We designed the SealTech System to be incredibly intuitive and on-the-go! Follow these simple steps for quick, easy, and satisfying vacuum sealing.</p>
                </div>
                <div class="grid sm:grid-cols-2 lg:grid-cols-5 gap-6 text-center">
                    <!-- Step 1 -->
                    <div class="bg-white p-6 rounded-xl shadow-md transition-shadow hover:shadow-lg">
                        <div class="text-4xl font-extrabold text-sky-600 mb-2">1</div>
                        <h4 class="font-semibold text-xl mb-2">Load</h4>
                        <p class="text-sm text-slate-600">Place your item(s) into the SealBag on a flat surface. </p>
                    </div>
                    <!-- Step 2 -->
                    <div class="bg-white p-6 rounded-xl shadow-md transition-shadow hover:shadow-lg">
                        <div class="text-4xl font-extrabold text-sky-600 mb-2">2</div>
                        <h4 class="font-semibold text-xl mb-2">Seal</h4>
                        <p class="text-sm text-slate-600">Firmly slide the zipper across the Sealing Track to close the bag</p>
                    </div>
                    <!-- Step 3 -->
                    <div class="bg-white p-6 rounded-xl shadow-md transition-shadow hover:shadow-lg">
                        <div class="text-4xl font-extrabold text-sky-600 mb-2">3</div>
                        <h4 class="font-semibold text-xl mb-2">Vacuum</h4>
                        <p class="text-sm text-slate-600">Attach the SealPump to the valve and select your desired operating mode.</p>
                    </div>
                    <!-- Step 4 -->
                    <div class="bg-white p-6 rounded-xl shadow-md transition-shadow hover:shadow-lg">
                        <div class="text-4xl font-extrabold text-sky-600 mb-2">4</div>
                        <h4 class="font-semibold text-xl mb-2">Compress</h4>
                        <p class="text-sm text-slate-600">The pump extracts air; the bag rapidly shrinks. The pump shuts off automatically.</p>
                    </div>
                    <!-- Step 5 -->
                    <div class="bg-white p-6 rounded-xl shadow-md transition-shadow hover:shadow-lg">
                        <div class="text-4xl font-extrabold text-sky-600 mb-2">5</div>
                        <h4 class="font-semibold text-xl mb-2">Store</h4>
                        <p class="text-sm text-slate-600">Remove the pump and store your now-compact and perfectly protected item.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Benefits Section -->
        <section id="benefits" class="py-20 bg-white">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-slate-800">Designed for Your Life</h2>
                    <p class="mt-4 max-w-3xl mx-auto text-lg text-slate-600">The SealTech system isn't just a product; it's a better way to manage your space and preserve your valuables. </p>
                </div>
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="text-center bg-slate-50 p-6 rounded-xl shadow-md">
                        <div class="text-4xl mb-3">üõ°Ô∏è</div>
                        <h4 class="text-xl font-semibold mb-2">Extreme Durability</h4>
                        <p class="text-slate-600">The SealBag is designed for heavy contents without rupturing under the high compression force.</p>
                    </div>
                    <div class="text-center bg-slate-50 p-6 rounded-xl shadow-md">
                        <div class="text-4xl mb-3">üíß</div>
                        <h4 class="text-xl font-semibold mb-2">Total Protection</h4>
                        <p class="text-slate-600">Creates a perfect seal that protects against mold, moisture, dust, and insects, keeping contents safe</p>
                    </div>
                    <div class="text-center bg-slate-50 p-6 rounded-xl shadow-md">
                        <div class="text-4xl mb-3">‚è±Ô∏è</div>
                        <h4 class="text-xl font-semibold mb-2">Rapid Operation</h4>
                        <p class="text-slate-600">The SealPump's turbine engine quickly achieves maximum vacuum. </p>
                    </div>
                </div>
            </div>
        </section>

    </main>
    
    <footer class="bg-slate-800 text-slate-300 py-8">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p>&copy; 2025 SealTech Systems. All rights reserved. Rayan Basit, Muhammad Kamran, Ali Salam.</p>
            <p class="text-sm text-slate-400 mt-2">Revolutionizing storage and preservation through science.</p>
        </div>
    </footer>

    <!-- Chart.js for the visual data representation -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // === SealTech App Logic ===
        
        // Constants for the simulation
        const INITIAL_PARTICLE_COUNT = 30;
        const PARTICLE_SPEED = 2; // Base speed multiplier
        
        // Bag Size Constants
        const INITIAL_WIDTH = 280;
        const INITIAL_HEIGHT = 200;
        const FINAL_WIDTH = 100; // Final visual size after compression
        const FINAL_HEIGHT = 70; // Final visual size after compression
        
        // Chart Constants
        const INITIAL_VOLUME_PCT = 100;
        const INITIAL_PRESSURE_PCT = 20;

        // Dynamic State Variables based on selected mode
        let currentMode = 'quick';
        let COMPRESSION_DURATION_MS = 3000;
        let FINAL_PARTICLE_COUNT = 6;
        let PARTICLES_TO_REMOVE = INITIAL_PARTICLE_COUNT - FINAL_PARTICLE_COUNT;
        let FINAL_VOLUME_PCT = 20;
        let FINAL_PRESSURE_PCT = 85;

        // Mode Configurations
        const modeConfigs = {
            quick: {
                name: 'Quick-Seal (Fast Compression)',
                duration: 3000, // Faster
                finalParticles: 6, // Less deep vacuum
                finalVolumePct: 25,
                finalPressurePct: 80,
                description: `
                    <h4 class="font-semibold text-lg mb-2">Maximum Compaction (Quick-Seal)</h4>
                    <p>The high-speed, high-flow mode is perfect for rapidly reducing the bulk of soft items like clothes and bedding, maximizing storage space in seconds.</p>
                `
            },
            deep: {
                name: 'Deep-Seal (Precision Vacuum)',
                duration: 5000, // Slower, for deep vacuum
                finalParticles: 2, // Near perfect vacuum
                finalVolumePct: 10,
                finalPressurePct: 95,
                description: `
                    <h4 class="font-semibold text-lg mb-2">Precision Vacuum (Deep-Seal)</h4>
                    <p>A slower, more controlled extraction process designed for long-term food preservation where eliminating nearly all air prevents moisture, oxidation, and freezer burn.</p>
                `
            }
        };

        let animationFrameId; // For requestAnimationFrame
        let startTime = null;
        let isSimulating = true;
        let particlesRemoved = 0; // Tracks particles removed during animation

        // Particle data structure
        const particles = [];

        const app = {
            chart: null,
            
            elements: {
                activateBtn: document.getElementById('activate-pump-btn'),
                resetBtn: document.getElementById('reset-btn'),
                sealBagVisual: document.getElementById('seal-bag-visual'),
                airParticlesContainer: document.getElementById('air-particles-container'),
                modeButtons: document.querySelectorAll('.mode-btn'),
                modeDescription: document.getElementById('mode-description'),
                sealPumpLight: document.getElementById('seal-pump-light'),
                // Elements for image upload (now present in HTML)
                imageInput: document.getElementById('model-image-upload'),
                imageDisplay: document.getElementById('uploaded-model-image'),
                imagePlaceholder: document.getElementById('image-upload-placeholder'),
                uploadStatus: document.getElementById('upload-status'),
            },

            // Current state of the bag (used for boundary checking)
            boundary: { 
                width: INITIAL_WIDTH, 
                height: INITIAL_HEIGHT 
            },

            init() {
                this.setMode('quick', true); // Initialize with default mode
                this.setupChart(INITIAL_VOLUME_PCT, INITIAL_PRESSURE_PCT);
                this.generateAirParticles(INITIAL_PARTICLE_COUNT);
                this.addEventListeners();
                this.simulationLoop(); // Start the particle movement loop immediately
            },

            // New function to apply mode settings and update globals
            setMode(mode, initial = false) {
                currentMode = mode;
                const config = modeConfigs[mode];
                COMPRESSION_DURATION_MS = config.duration;
                FINAL_PARTICLE_COUNT = config.finalParticles;
                FINAL_VOLUME_PCT = config.finalVolumePct;
                FINAL_PRESSURE_PCT = config.finalPressurePct;
                PARTICLES_TO_REMOVE = INITIAL_PARTICLE_COUNT - FINAL_PARTICLE_COUNT;
                
                // Update description panel
                this.elements.modeDescription.innerHTML = config.description;

                // Ensure the chart reflects the starting state when mode is changed (unless it's the very first init)
                if (!initial) {
                    this.resetAnimation();
                }
            },

            setupChart(volume, pressure) {
                const ctx = document.getElementById('boylesLawChart').getContext('2d');
                
                // Destroy existing chart if it exists
                if (this.chart) {
                    this.chart.destroy();
                }

                this.chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Volume (%)', 'Effective Pressure (%)'],
                        datasets: [{
                            label: 'State',
                            data: [volume, pressure],
                            backgroundColor: ['rgba(56, 189, 248, 0.7)', 'rgba(100, 116, 139, 0.7)'],
                            borderColor: ['rgba(56, 189, 248, 1)', 'rgba(100, 116, 139, 1)'],
                            borderWidth: 1,
                            borderRadius: 6
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        responsive: true,
                        animation: false, // Disable default Chart.js animation for dynamic updates
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    callback: function(value) { return value + '%' }
                                },
                                title: { display: true, text: 'Percentage' }
                            },
                            x: {
                                grid: { display: false }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            title: {
                                display: true,
                                text: 'Volume vs. Effective Pressure (Initial State)',
                                font: { size: 16, weight: 'bold' }
                            }
                        }
                    }
                });
            },
            
            // Function to dynamically update the chart during animation
            updateChart(volume, pressure) {
                this.chart.data.datasets[0].data = [volume, pressure];
                // Display the actual particle count in the title for clarity
                this.chart.options.plugins.title.text = `Current State (${modeConfigs[currentMode].name}, Particles: ${particles.length})`;
                this.chart.update('none'); // Update immediately without animation
            },

            generateAirParticles(count) {
                // Clear existing visuals and array
                this.elements.airParticlesContainer.innerHTML = '';
                particles.length = 0; 
                particlesRemoved = 0;
                
                // Ensure initial positions are within the *current* reset boundary
                const initialW = this.boundary.width;
                const initialH = this.boundary.height;

                for (let i = 0; i < count; i++) {
                    const particleEl = document.createElement('div');
                    particleEl.className = 'air-particle';
                    this.elements.airParticlesContainer.appendChild(particleEl);
                    
                    // Random starting position (x, y) and velocity (dx, dy)
                    const x = Math.random() * initialW; 
                    const y = Math.random() * initialH;
                    const dx = (Math.random() - 0.5) * PARTICLE_SPEED;
                    const dy = (Math.random() - 0.5) * PARTICLE_SPEED;
                    
                    particles.push({ x, y, dx, dy, element: particleEl });
                }
            },
            
            // The core physics loop for particle movement and collision
            updateParticles() {
                const { width, height } = this.boundary;
                const particleSize = 5; // Particle width/height in px

                particles.forEach(p => {
                    // Update position
                    p.x += p.dx;
                    p.y += p.dy;

                    // Boundary collision (reverses direction)
                    // Clamp position to prevent particles from escaping during shrinking
                    if (p.x <= 0 || p.x + particleSize >= width) {
                        p.dx *= -1;
                        p.x = Math.max(0, Math.min(p.x, width - particleSize)); 
                    }
                    if (p.y <= 0 || p.y + particleSize >= height) {
                        p.dy *= -1;
                        p.y = Math.max(0, Math.min(p.y, height - particleSize)); 
                    }

                    // Apply position to DOM element
                    p.element.style.transform = `translate(${p.x}px, ${p.y}px)`;
                });
            },

            // Main animation loop using requestAnimationFrame
            simulationLoop(timestamp) {
                if (!isSimulating) {
                    cancelAnimationFrame(animationFrameId);
                    return;
                }
                
                if (startTime !== null) {
                    const elapsed = timestamp - startTime;
                    const progress = Math.min(1, elapsed / COMPRESSION_DURATION_MS);
                    
                    // 1. Calculate current size (Visual Shrinking)
                    const currentWidth = INITIAL_WIDTH - (INITIAL_WIDTH - FINAL_WIDTH) * progress;
                    const currentHeight = INITIAL_HEIGHT - (INITIAL_HEIGHT - FINAL_HEIGHT) * progress;
                    
                    this.elements.sealBagVisual.style.width = `${currentWidth}px`;
                    this.elements.sealBagVisual.style.height = `${currentHeight}px`;

                    // Update physics boundary
                    this.boundary.width = currentWidth;
                    this.boundary.height = currentHeight;
                    
                    // 2. Particle Removal Logic
                    if (progress < 1) {
                        // Determine how many particles *should* have been removed by this point
                        const targetRemoved = Math.floor(progress * PARTICLES_TO_REMOVE);
                        const particlesToRemoveNow = targetRemoved - particlesRemoved;

                        for (let i = 0; i < particlesToRemoveNow; i++) {
                            if (particles.length > FINAL_PARTICLE_COUNT) {
                                // Remove a random particle (simulating extraction)
                                const randomIndex = Math.floor(Math.random() * particles.length);
                                const particle = particles.splice(randomIndex, 1)[0];
                                // Use a fade-out effect before removal
                                particle.element.style.opacity = '0'; 
                                setTimeout(() => particle.element.remove(), 500); 
                                particlesRemoved++;
                            }
                        }
                    }

                    // 3. Update Chart (interpolate values)
                    const currentVolume = INITIAL_VOLUME_PCT - (INITIAL_VOLUME_PCT - FINAL_VOLUME_PCT) * progress;
                    const currentPressure = INITIAL_PRESSURE_PCT + (FINAL_PRESSURE_PCT - INITIAL_PRESSURE_PCT) * progress;
                    this.updateChart(currentVolume, currentPressure);

                    if (progress >= 1) {
                        startTime = null; // Animation finished
                        this.elements.activateBtn.disabled = true; // Disable until reset
                        this.elements.sealBagVisual.classList.add('bg-sky-600/20', 'border-sky-800'); // Final sealed look
                        this.elements.sealBagVisual.classList.remove('border-dashed');
                        
                        // Turn off the pump light when done
                        this.elements.sealPumpLight.classList.remove('pump-on');
                    }
                }
                
                this.updateParticles();
                animationFrameId = requestAnimationFrame(this.simulationLoop.bind(this));
            },

            addEventListeners() {
                this.elements.activateBtn.addEventListener('click', () => this.runAnimation());
                this.elements.resetBtn.addEventListener('click', () => this.resetAnimation());
                
                this.elements.modeButtons.forEach(button => {
                    button.addEventListener('click', (e) => this.handleModeChange(e));
                });

                // Image upload handler
                this.elements.imageInput.addEventListener('change', (e) => this.handleImageSelect(e));

                // Smooth scrolling for navigation
                document.querySelectorAll('header nav a').forEach(anchor => {
                    anchor.addEventListener('click', function (e) {
                        e.preventDefault();
                        document.querySelector(this.getAttribute('href')).scrollIntoView({
                            behavior: 'smooth'
                        });
                    });
                });
            },
            
            runAnimation() {
                // Ignore if already running
                if (startTime !== null) return;

                this.elements.activateBtn.classList.add('hidden');
                this.elements.resetBtn.classList.remove('hidden');
                this.elements.activateBtn.disabled = false;

                // Reset visual state for compression
                this.elements.sealBagVisual.classList.remove('bg-sky-600/20', 'border-sky-800');
                this.elements.sealBagVisual.classList.add('border-dashed');

                // Turn the pump light on
                this.elements.sealPumpLight.classList.add('pump-on');

                startTime = performance.now(); // Start the compression timer
                if (!isSimulating) { // Restart loop if stopped
                    isSimulating = true;
                    this.simulationLoop();
                }
            },

            resetAnimation() {
                this.elements.activateBtn.classList.remove('hidden');
                this.elements.resetBtn.classList.add('hidden');
                this.elements.activateBtn.disabled = false;
                
                // Stop the compression timer and reset the physics boundary
                startTime = null;
                this.boundary.width = INITIAL_WIDTH;
                this.boundary.height = INITIAL_HEIGHT;
                
                // Reset bag visual
                this.elements.sealBagVisual.style.width = `${INITIAL_WIDTH}px`;
                this.elements.sealBagVisual.style.height = `${INITIAL_HEIGHT}px`;
                this.elements.sealBagVisual.classList.remove('bg-sky-600/20', 'border-sky-800');
                this.elements.sealBagVisual.classList.add('border-dashed');
                
                // Turn the pump light off
                this.elements.sealPumpLight.classList.remove('pump-on');

                // Reset particles (re-generate initial count)
                this.generateAirParticles(INITIAL_PARTICLE_COUNT);

                // Reset chart
                this.updateChart(INITIAL_VOLUME_PCT, INITIAL_PRESSURE_PCT);
                this.chart.options.plugins.title.text = 'Volume vs. Effective Pressure (Initial State)';
                this.chart.update('none');
            },

            // FIX: Completed the cut-off function
            handleModeChange(e) {
                const selectedMode = e.currentTarget.dataset.mode;
                this.setMode(selectedMode); // Apply new mode constants

                // Update button visual state
                this.elements.modeButtons.forEach(btn => {
                    btn.classList.remove('border-sky-600', 'text-sky-600');
                    btn.classList.add('border-transparent', 'text-slate-500');
                });
                
                e.currentTarget.classList.add('border-sky-600', 'text-sky-600');
                e.currentTarget.classList.remove('border-transparent', 'text-slate-500');

                // Reset the simulation to start state to reflect new mode settings
                this.resetAnimation();
            },
            
            // Simulated Image Upload Handler
            handleImageSelect(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        this.elements.imageDisplay.querySelector('img').src = event.target.result;
                        this.elements.imageDisplay.classList.remove('hidden');
                        this.elements.imagePlaceholder.classList.add('hidden');
                        this.elements.uploadStatus.textContent = `File selected: ${file.name}`;
                    };
                    reader.readAsDataURL(file);
                } else {
                    this.elements.imageDisplay.classList.add('hidden');
                    this.elements.imagePlaceholder.classList.remove('hidden');
                    this.elements.uploadStatus.textContent = `No file selected.`;
                }
            }
        };

        window.onload = function() {
            app.init();
        };

    </script>

